{% extends 'base.html' %}

{% block head %}
    <title>{{ post.name }}</title>
    
    <!-- Open Graph tags -->
    <meta property="og:title" content="{{ post.name }}" />
    <meta property="og:description" content="{{ post.description|truncatewords:30 }}" />
    <meta property="og:image" content="/media/{{ post.picture }}" />
    <meta property="og:url" content="{{ request.build_absolute_uri }}" />
    <meta property="og:type" content="article" />
    
    <!-- Twitter Card tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{ post.name }}" />
    <meta name="twitter:description" content="{{ post.description|truncatewords:30 }}" />
    <meta name="twitter:image" content="/media/{{ post.picture }}" />
{% endblock %}

{% block title %}
{% with tags=post.tags.all %}
  {% if tags %}
    {{ tags|join:", " }}  <!-- Join tag names with a comma -->
  {% else %}
    No Tags
  {% endif %}
{% endwith %}
{% endblock %}

{% block content %}
<style>
/* Global styles */
.nobox-button {
    margin-left: auto;
    margin-right: 12px;
    all: unset;
    color: gray;
    padding: 10px;
    border-radius: 10px;
    background-color: var(--gold);
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    justify-content: center;
    align-items: center;
    z-index: 10000;
    cursor: pointer;
}

.modal img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    cursor: default;
}

.modal.active {
    display: flex;
}

.close2 {
    position: absolute;
    right: 10px;
    color: white;
    top: 10px;
    font-size: 24px;
    cursor: pointer;
}

.more-info {
    padding: 12px;
    max-width: 1200px;
}

.more-info p {
    font-size: 18px;
}

.more-info img {
    width: 100%;
    max-height: 270px;
    object-fit: cover;
}

.more-info small {
    color: gray;
}

.label {
    font-size: 12px;
    color: gray;
}

.more-info .contact {
    margin-top: 10px;
    font-size: 24px;
}

.go-back {
    position: fixed;
    bottom: 30px;
    font-size: 42px;
    animation: goUp ease 400ms forwards;
    background: black;    
}

.rate label {
    all: unset;
}

.rate label small {
    color: gray;
    font-size: 16px;
}

@keyframes goUp {
    0% { bottom: 50px; transform: scale(1); }
    100% { transform: scale(0.7); bottom: 90px; }
}

.text {
    font-family: inherit;
    font-weight: light;
}
</style>

<div class="modal" id="modal">
    <span class="close2" id="close">&times;</span>
    <img src="/media/{{ post.picture }}" alt="Modal Image" id="modalImage" />
</div>

<div style="padding: 12px; margin: auto; max-width: 400px; background-color: white; box-shadow: var(--shadow);">
    <div class="go-back publish" onclick="window.history.back()"><</div>
    <img class="Hello" style="width: 100%; max-height: 100%; aspect-ratio: 1; object-fit: cover; cursor: pointer;" src="/media/{{ post.picture }}" alt="Post Image">
    <div style="position: absolute; color: white; width: auto; font-weight: bold; font-size: 32px; top: 12px; right: 12px;">
        {% if post.price == 0 %}
            –î–æ–≥–æ–≤–æ—Ä
        {% else %}
            {{ post.price|floatformat:0 }} —Å–æ–º
        {% endif %}
    </div>
    <div style="pointer-events: none; color: gray; display: flex; width: 100%; gap: 4px; flex-wrap: wrap; margin-top: 10px; position: absolute; bottom: 0; left: 0; padding: 12px; color: white;">
        –¢–µ–≥–∏:<br>
        {% for tag in post.tags.all %}
            <div style="color: white">#{{ tag.name }}</div>
        {% endfor %}
    </div>
</div>

<div style="margin-top: 10px;">
    <button class="nobox-button" onclick="navigator.share({ url: window.location.href })">Share X_x</button>      
    <pre style="white-space: pre-wrap; font-size: 16px;" id="text" class="text">{{ post.description }}</pre>
    
    <div>
        <br/>
        <form style="display: flex; gap: 20px; font-size: 36px; justify-content: center; padding: 20px 0px 40px 0px; text-align: center;" class="rate">
            <label onclick="alert('–í—ã –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –ª–∞–π–∫!')">üòç <input value="1" edit="false" style="display: none"/><br/><small>28</small></label>
            <label style="flex: 1;" onclick="alert('–°–ø–∞—Å–∏–±–æ!')">üôÇ <input value="0" edit="false" style="display: none" /><br/><small>21</small></label>
            <label style="flex: 1;" onclick="alert('–ü—Ä–∏–Ω—è—Ç–æ...')">üòÜ <input value="1" edit="false" style="display: none" /><br/><small>10</small></label>
            <label style="flex: 1;" onclick="alert('–û—Å—Ç–∞–≤—å —Å–≤–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã, –º—ã —Å–≤—è–∂–µ–º—Å—è')">üèö <input value="1" edit="false" style="display: none" /><br/><small>15</small></label>
            <label style="flex: 1;" onclick="alert('–ü–æ—Å—Ç –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!')">üë®‚Äçüíª <input value="1" edit="false" style="display: none" /><br/><small>5</small></label>
        </form>

        <footer style="all: unset;">
            <div style="width: 100%; border-radius: 0px 0px 8px 8px;">
                <div class="label">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</div>
                {{ post.time_since_posted }}
                <br/><br/>
                {% if not post.author.is_staff %}
                <div class="label">–ö–æ–Ω—Ç–∞–∫—Ç—ã:</div>
                <h3> 
                    <b>+
                    {% if post.state == "active" %}
                        {% with post.author.phone_number as number %}
                            {{ number|slice:":3" }} {{ number|slice:"3:6" }} {{ number|slice:"6:" }}
                        {% endwith %}
                    {% else %}
                        üèö –û–±—ä—è–≤–ª–µ–Ω–∏–µ —É–∂–µ –≤ –∞—Ä—Ö–∏–≤–µ...
                    {% endif %}
                    {% endif %}
                    </b>
                </h3>
            </div>
        </footer>
    </div>
</div>

<script>
window.onload = function () {
    const openTrigger = document.querySelector(".Hello");
    const modal = document.getElementById("modal");
    const closeBtn = document.getElementById("close");

    openTrigger.addEventListener("click", function () {
        modal.classList.add("active");
    });

    function closeModal() {
        modal.classList.remove("active");
    }

    modal.addEventListener("click", function (event) {
        if (event.target === modal) {
            closeModal();
        }
    });

    closeBtn.addEventListener("click", closeModal);
    document.getElementById("modalImage").addEventListener("click", closeModal);
};
</script>
{% endblock %}